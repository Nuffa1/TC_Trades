
# **Macro-Driven Sector Rotation Framework**

A **macro-based sector rotation** system that detects the current **economic regime** using economic indicators, maps regimes to historically strong sectors, applies **asset-level confirmation filters**, and builds a rules-driven sector portfolio.
The entire workflow is automated

---

## **Economic Regime Model**

This framework classifies the economy into five phases:

* **Early Expansion**
* **Mid Expansion**
* **Late Expansion**
* **Recession**
* **Recovery**

Each regime corresponds to a distinct set of sector leadership characteristics that guide allocation.

---

## **Macroeconomic Indicators**

The system uses four core macro indicator groups:

* **Consumer** (spending, retail activity)
* **Labor** (employment, wage pressure, claims)
* **Inflation** (price pressure, rate environment)
* **Credit conditions** (spreads, risk premiums)

Indicators are normalized, z-scored, smoothed, and aggregated into three composite signals:

* **Growth**
* **Inflation Pressure**
* **Financial Stress**

These drive the regime classification.

---

## **Sector-Regime Mapping**

Each regime has a predefined set of sectors that historically outperform in that macro environment.

Example mappings include:

* Early Expansion → **XLY, XLF, XLI, XLK**
* Recession → **XLP, XLU, XLV**
* Recovery → **XLY, XLI, XLF**

This mapping defines the investing “universe” for each rebalance window.

---

## **Asset-Level Confirmation**

After selecting sectors, asset-level screens determine which ETFs are actually strong enough to hold:

* **Momentum** (126-day returns)
* **Volatility filters** (reject top-decile risk)
* **Relative strength** vs. a sector benchmark
* **Composite ranking** → selects the strongest tickers

---

## **Portfolio Construction**

Rules used to build the final portfolio:

* Equal-weighting with **maximum per-sector weight caps**
* **Monthly rebalancing**
* **Transaction costs** (default 5 bps)
* Weight normalization when assets drop in/out
* Fully systematic, no discretionary overrides

---

## **Backtesting Engine**

Simulates:

* Daily returns
* Monthly rotations
* Turnover & cost impact
* Equity curve generation
* A detailed **trade log** of every rebalance:

  * Regime
  * Sectors available
  * Selected tickers
  * Final weights
  * Turnover
  * Portfolio value before rebalance

Outputs include:

* **equity_curve.csv**
* **regimes.csv**
* **trade_log.csv**

---

# **File Overview (What Each File Does)**

### **`sector.py`**

Core engine of the entire framework.
Contains:

* Macro normalization & composite scoring
* Regime classification (quantile-based rules)
* Regime smoothing
* Sector–regime mapping
* Momentum, volatility, and relative strength filters
* Portfolio weighting model
* Full backtester implementation
* End-to-end `run_pipeline()` wrapper


---

### **`update_macro.py`**

Script to **download and transform macroeconomic indicators** from Yahoo Finance.
It:

1. Downloads XRT, VTI, TIP, and HYG
2. Applies safe transformations (e.g., 3-month returns, 1-year signals)
3. Resamples to daily frequency
4. Writes the final macro dataset to **macro.csv**
5. Logs all activity to **update_macro.log**


This is the script you run to refresh macro data.

---

### **`macro.csv`**

Processed and standardized macro indicator dataset produced by `update_macro.py`.
These series are the inputs to the macro regime classifier.

---

### **`equity_curve.csv`**

Full backtested equity curve generated by the backtester.
Used for performance evaluation.

---

### **`regimes.csv`**

The model’s time series of detected economic regimes.
Generated by `detect_regime_series_smoothed()`.

---

### **`trade_log.csv`**

Every rebalance event with details:

* regime at that date
* sectors available
* chosen tickers
* resulting weights
* turnover
* portfolio value

Used heavily by the reporting script.


---

### **`analyze_trades.py`**

Reporting script that loads the trade log and prints:

* Total number of rebalances
* Trades by regime
* Average turnover
* Sample trade from each regime
* Top turnover events
* Portfolio performance (CAGR, total return, highs/lows)


---

### **`backtest.py`**

Automation wrapper that orchestrates the full workflow:

1. Load macro data
2. Gather all sector tickers
3. Download historical price data
4. Run the end-to-end pipeline (`run_pipeline`)
5. Save outputs:

   * `equity_curve.csv`
   * `trade_log.csv`
   * `regimes.csv`
6. Print summary results

This is the main script to run a full backtest.


---


# **Goals of the Framework**

* **Detect macro regimes** using robust, multi-indicator composites
* **Map regimes to sectors** based on historical outperformance
* Apply **asset-level confirmation** to ensure sector leadership
* Build a structural, low-noise **sector rotation portfolio**
* Provide a reproducible **backtest with realistic constraints**
* Automate the entire pipeline for continuous updating



